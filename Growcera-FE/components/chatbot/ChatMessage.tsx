import React from 'react';
import { View, Text } from 'react-native';
import SvgIcon from './SvgIcon';
import Markdown from 'react-native-markdown-display';

interface ChatMessageProps {
    isUser?: boolean;
    message: string;
    icon?: string;
}

const ChatMessage: React.FC<ChatMessageProps> = ({ isUser = false, message, icon }) => {
    const userIconSvg = `<svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_9_907)">
      <path d="M8.48438 3.5C8.48438 2.91984 8.25391 2.36344 7.84367 1.9532C7.43344 1.54297 6.87704 1.3125 6.29688 1.3125C5.71671 1.3125 5.16031 1.54297 4.75008 1.9532C4.33984 2.36344 4.10938 2.91984 4.10938 3.5C4.10938 4.08016 4.33984 4.63656 4.75008 5.0468C5.16031 5.45703 5.71671 5.6875 6.29688 5.6875C6.87704 5.6875 7.43344 5.45703 7.84367 5.0468C8.25391 4.63656 8.48438 4.08016 8.48438 3.5ZM2.79688 3.5C2.79688 2.57174 3.16562 1.6815 3.822 1.02513C4.47838 0.368749 5.36862 0 6.29688 0C7.22513 0 8.11537 0.368749 8.77175 1.02513C9.42813 1.6815 9.79688 2.57174 9.79688 3.5C9.79688 4.42826 9.42813 5.3185 8.77175 5.97487C8.11537 6.63125 7.22513 7 6.29688 7C5.36862 7 4.47838 6.63125 3.822 5.97487C3.16562 5.3185 2.79688 4.42826 2.79688 3.5ZM1.51992 12.6875H11.0738C10.8305 10.9566 9.34297 9.625 7.54648 9.625H5.04727C3.25078 9.625 1.76328 10.9566 1.51992 12.6875ZM0.171875 13.1879C0.171875 10.4945 2.35391 8.3125 5.04727 8.3125H7.54648C10.2398 8.3125 12.4219 10.4945 12.4219 13.1879C12.4219 13.6363 12.0582 14 11.6098 14H0.983984C0.535547 14 0.171875 13.6363 0.171875 13.1879Z" fill="#4B5563"></path>
    </g>
    <defs>
      <clipPath id="clip0_9_907">
        <path d="M0.171875 0H12.4219V14H0.171875V0Z" fill="white"></path>
      </clipPath>
    </defs>
  </svg>`;

    const botIconSvg = `<svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_9_900)">
      <path d="M9 0C9.48398 0 9.875 0.391016 9.875 0.875V2.625H13.1562C14.2445 2.625 15.125 3.50547 15.125 4.59375V12.0312C15.125 13.1195 14.2445 14 13.1562 14H4.84375C3.75547 14 2.875 13.1195 2.875 12.0312V4.59375C2.875 3.50547 3.75547 2.625 4.84375 2.625H8.125V0.875C8.125 0.391016 8.51602 0 9 0ZM5.9375 10.5C5.69688 10.5 5.5 10.6969 5.5 10.9375C5.5 11.1781 5.69688 11.375 5.9375 11.375H6.8125C7.05312 11.375 7.25 11.1781 7.25 10.9375C7.25 10.6969 7.05312 10.5 6.8125 10.5H5.9375ZM8.5625 10.5C8.32187 10.5 8.125 10.6969 8.125 10.9375C8.125 11.1781 8.32187 11.375 8.5625 11.375H9.4375C9.67813 11.375 9.875 11.1781 9.875 10.9375C9.875 10.6969 9.67813 10.5 9.4375 10.5H8.5625ZM11.1875 10.5C10.9469 10.5 10.75 10.6969 10.75 10.9375C10.75 11.1781 10.9469 11.375 11.1875 11.375H12.0625C12.3031 11.375 12.5 11.1781 12.5 10.9375C12.5 10.6969 12.3031 10.5 12.0625 10.5H11.1875ZM7.46875 7C7.46875 6.70992 7.35352 6.43172 7.1484 6.2266C6.94328 6.02148 6.66508 5.90625 6.375 5.90625C6.08492 5.90625 5.80672 6.02148 5.6016 6.2266C5.39648 6.43172 5.28125 6.70992 5.28125 7C5.28125 7.29008 5.39648 7.56828 5.6016 7.7734C5.80672 7.97852 6.08492 8.09375 6.375 8.09375C6.66508 8.09375 6.94328 7.97852 7.1484 7.7734C7.35352 7.56828 7.46875 7.29008 7.46875 7ZM11.625 8.09375C11.9151 8.09375 12.1933 7.97852 12.3984 7.7734C12.6035 7.56828 12.7188 7.29008 12.7188 7C12.7188 6.70992 12.6035 6.43172 12.3984 6.2266C12.1933 6.02148 11.9151 5.90625 11.625 5.90625C11.3349 5.90625 11.0567 6.02148 10.8516 6.2266C10.6465 6.43172 10.5312 6.70992 10.5312 7C10.5312 7.29008 10.6465 7.56828 10.8516 7.7734C11.0567 7.97852 11.3349 8.09375 11.625 8.09375ZM1.5625 6.125H2V11.375H1.5625C0.837891 11.375 0.25 10.7871 0.25 10.0625V7.4375C0.25 6.71289 0.837891 6.125 1.5625 6.125ZM16.4375 6.125C17.1621 6.125 17.75 6.71289 17.75 7.4375V10.0625C17.75 10.7871 17.1621 11.375 16.4375 11.375H16V6.125H16.4375Z" fill="white"></path>
    </g>
    <defs>
      <clipPath id="clip0_9_900">
        <path d="M0.25 0H17.75V14H0.25V0Z" fill="white"></path>
      </clipPath>
    </defs>
  </svg>`;

    return (
        <View className={`flex-row my-2 mx-4 ${isUser ? 'justify-end' : 'justify-start'}`}>
            {!isUser && (
                <View className="bg-blue-600 h-8 w-8 rounded-full items-center justify-center mr-2">
                    <SvgIcon svgString={icon || botIconSvg} width={18} height={14} />
                </View>
            )}

            <View
                className={`px-4 py-3 rounded-2xl max-w-[80%] ${isUser ? 'bg-blue-500' : 'bg-gray-100'
                    }`}
            >
                <Markdown
                    style={{
                        body: {
                            color: isUser ? 'white' : '#1F2937',
                            fontSize: 16,
                        },
                    }}
                >
                    {message}
                </Markdown>
            </View>

            {isUser && (
                <View className="bg-gray-400 h-8 w-8 rounded-full items-center justify-center ml-2">
                    <SvgIcon svgString={userIconSvg} width={13} height={14} />
                </View>
            )}
        </View>
    );
};

export default ChatMessage;
